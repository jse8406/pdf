<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ PDF ë¬¸ì„œ ë¹„êµê¸° (Web Ver.)</title>
    <!-- PDF.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Diff Match Patch (Replaced with jsdiff for better stability) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.2.0/diff.min.js"></script>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --border-color: #dee2e6;
            --del-bg: #ffeef0;
            --del-color: #b31d28;
            --ins-bg: #e6ffed;
            --ins-color: #22863a;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
        }
        .file-input-wrapper {
            flex: 1;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .file-input-wrapper label {
            display: block;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        .drop-zone {
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #f8f9fa;
            position: relative;
        }
        .drop-zone:hover, .drop-zone.dragover {
            border-color: #0066ff;
            background-color: #eef4ff;
            transform: translateY(-2px);
        }
        .drop-zone.active {
            border-color: #22863a;
            background-color: #f0fff4;
            border-style: solid;
        }
        .drop-zone p {
            margin: 0;
            color: #666;
            font-size: 0.95em;
            line-height: 1.5;
        }
        .drop-zone .icon {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }
        .file-name {
            margin-top: 15px;
            font-weight: bold;
            color: #0066ff;
            font-size: 0.9em;
            word-break: break-all;
        }
        input[type="file"] {
            display: none;
        }
        button#compareBtn {
            display: block;
            width: 200px;
            margin: 0 auto 30px;
            padding: 12px;
            background-color: #0066ff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button#compareBtn:hover {
            background-color: #0052cc;
        }
        button#compareBtn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .diff-container {
            display: flex;
            gap: 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            min-height: 500px;
        }
        .panel {
            flex: 1;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 15px;
            overflow-y: auto;
            max-height: 800px;
            background-color: #fff;
            line-height: 1.6;
            font-size: 14px;
            white-space: pre-wrap; /* ì¤„ë°”ê¿ˆ ìœ ì§€ */
        }
        .panel-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
        }
        /* Highlight Styles */
        del {
            background-color: var(--del-bg);
            color: var(--del-color);
            text-decoration: none; /* ì·¨ì†Œì„  ëŒ€ì‹  ìƒ‰ìƒìœ¼ë¡œ */
            border-bottom: 1px solid var(--del-color);
            padding: 2px 0;
        }
        ins {
            background-color: var(--ins-bg);
            color: var(--ins-color);
            text-decoration: none;
            border-bottom: 1px solid var(--ins-color);
            padding: 2px 0;
        }
        .section-header {
            font-size: 1.2em;
            font-weight: bold;
            color: #0066ff;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
        }
        #loading {
            display: none;
            text-align: center;
            font-size: 18px;
            margin: 20px 0;
            color: #0066ff;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ“„ ìŠ¤ë§ˆíŠ¸ PDF ë¬¸ì„œ ë¹„êµê¸° (Web Ver.)</h1>
    <p>ì„œë²„ ì „ì†¡ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì•ˆì „í•˜ê²Œ ë¹„êµí•˜ì„¸ìš”. (íš¨ëŠ¥Â·ìš©ë²•Â·ì£¼ì˜ì‚¬í•­ ì¶”ì¶œ)</p>
</div>

<div class="controls">
    <div class="file-input-wrapper">
        <label>ğŸ“ ì´ì „ ë²„ì „ (Old PDF)</label>
        <div class="drop-zone" id="drop-zone-1">
            <span class="icon">ğŸ“„</span>
            <p>ì´ê³³ì„ í´ë¦­í•˜ê±°ë‚˜<br>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ìœ¼ì„¸ìš”</p>
            <input type="file" id="file1" accept="application/pdf">
            <div class="file-name" id="file-name-1"></div>
        </div>
    </div>
    <div class="file-input-wrapper">
        <label>ğŸ“ ìƒˆë¡œìš´ ë²„ì „ (New PDF)</label>
        <div class="drop-zone" id="drop-zone-2">
            <span class="icon">ğŸ†•</span>
            <p>ì´ê³³ì„ í´ë¦­í•˜ê±°ë‚˜<br>íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ìœ¼ì„¸ìš”</p>
            <input type="file" id="file2" accept="application/pdf">
            <div class="file-name" id="file-name-2"></div>
        </div>
    </div>
</div>

<button id="compareBtn">ğŸ” ë¹„êµ ì‹œì‘í•˜ê¸°</button>
<div id="loading">ë¬¸ì„œ ë¶„ì„ ë° ë¹„êµ ì¤‘... â³</div>

<div class="diff-container">
    <div class="panel">
        <div class="panel-header" style="color: #b31d28;">[ì´ì „ ë¬¸ì„œ] ì‚­ì œ/ë³€ê²½ëœ ë‚´ìš©</div>
        <div id="output1"></div>
    </div>
    <div class="panel">
        <div class="panel-header" style="color: #22863a;">[ìƒˆ ë¬¸ì„œ] ì¶”ê°€/ë³€ê²½ëœ ë‚´ìš©</div>
        <div id="output2"></div>
    </div>
</div>

<div class="summary-container" style="margin-top: 30px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
    <h3 style="border-bottom: 2px solid #0066ff; padding-bottom: 10px; color: #333; margin-top: 0;">ğŸ“‹ í•µì‹¬ ë³€ê²½ ìš”ì•½ (ì£¼ìš” ë¬¸ì¥/ë‹¨ë½)</h3>
    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">* ë‹¨ìˆœ ì˜¤íƒ€ë‚˜ ì§§ì€ ìˆ˜ì •ì€ ì œì™¸í•˜ê³ , <strong>15ê¸€ì ì´ìƒ</strong>ì˜ êµµì§í•œ ë³€ê²½ì‚¬í•­ë§Œ ëª¨ì•„ì„œ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
    <div id="summaryOutput" style="line-height: 1.6;"></div>
</div>

<script>
    // PDF.js Worker ì„¤ì •
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // ---------------------------------------------------------
    // 1. í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° í•„í„°ë§ ë¡œì§ (Python ë¡œì§ í¬íŒ…)
    // ---------------------------------------------------------
    
    async function extractTextFromPdf(file) {
        if (!file) return "";
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = "";

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            
            // PDF.jsëŠ” í…ìŠ¤íŠ¸ ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¤ë‹ˆë‹¤. ì´ë¥¼ ì¤„ë°”ê¿ˆ ë“±ì„ ê³ ë ¤í•´ í•©ì¹©ë‹ˆë‹¤.
            let lastY = -1;
            let pageText = "";
            for (let item of textContent.items) {
                // Yì¢Œí‘œê°€ í¬ê²Œ ë°”ë€Œë©´ ì¤„ë°”ê¿ˆìœ¼ë¡œ ê°„ì£¼ (ê°„ë‹¨í•œ ë¡œì§)
                if (lastY !== -1 && Math.abs(item.transform[5] - lastY) > 5) {
                    pageText += "\n";
                }
                pageText += item.str + " "; // ë‹¨ì–´ ê°„ ê³µë°±
                lastY = item.transform[5];
            }
            fullText += pageText + "\n";
        }
        return extractTargetSections(fullText);
    }

    function extractTargetSections(fullText) {
        // 1. í—¤ë” ì°¾ê¸° (Regex)
        // Python: r"(?m)^[\s\d\.\â€¢\[ã€\|Â·\-]*(?:" + keyword_pattern + r")[^\n]{0,50}$"
        // JSëŠ” (?m) í”Œë˜ê·¸ê°€ ì—†ìœ¼ë¯€ë¡œ 'm' í”Œë˜ê·¸ ì‚¬ìš©
        const keywordPattern = "(?:íš¨\\s*ëŠ¥|íš¨\\s*ê³¼|ìš©\\s*ë²•|ìš©\\s*ëŸ‰|íˆ¬\\s*ì—¬|ì£¼\\s*ì˜\\s*ì‚¬\\s*í•­|ê²½\\s*ê³ |ì„±\\s*ìƒ|ì €\\s*ì¥|ë³´\\s*ê´€|ê¸°\\s*ê°„|ì›\\s*ë£Œ|ì œ\\s*ì¡°|í¬\\s*ì¥|êµ¬\\s*ì„±)";
        const headerRegex = new RegExp(`^[\\s\\d\\.\\â€¢\\[ã€\\|Â·\\-]*(${keywordPattern})[^\\n]{0,50}$`, "gm");

        let matches = [];
        let match;
        while ((match = headerRegex.exec(fullText)) !== null) {
            matches.push({
                text: match[0].trim(),
                index: match.index,
                end: match.index + match[0].length
            });
        }

        if (matches.length === 0) return extractFallback(fullText); // Fallback

        // Target Keywords
        const targetGroups = {
            "íš¨ëŠ¥": ["íš¨ëŠ¥", "íš¨ê³¼"],
            "ìš©ë²•": ["ìš©ë²•", "ìš©ëŸ‰", "íˆ¬ì—¬"],
            "ì£¼ì˜": ["ì£¼ì˜", "ê²½ê³ ", "í™˜ì"]
        };

        let result = "";

        for (let i = 0; i < matches.length; i++) {
            const header = matches[i];
            const cleanTitle = header.text.replace(/[\s\[\]ã€ã€‘\.\d\â€¢]/g, "");
            
            let isTarget = false;
            for (let key in targetGroups) {
                if (targetGroups[key].some(t => cleanTitle.includes(t))) {
                    isTarget = true;
                    break;
                }
            }
            
            if (isTarget) {
                const startPos = header.end;
                const endPos = (i < matches.length - 1) ? matches[i+1].index : fullText.length;
                let content = fullText.substring(startPos, endPos).trim();
                
                if (content.length > 2) {
                    result += `\n\n--- [${header.text}] ---\n${content}`;
                }
            }
        }
        return result;
    }

    function extractFallback(fullText) {
        // ê°„ë‹¨íˆ ì „ì²´ í…ìŠ¤íŠ¸ ë°˜í™˜ í˜¹ì€ ì¶”ê°€ ë¡œì§ êµ¬í˜„ ê°€ëŠ¥
        return fullText;
    }

    // ---------------------------------------------------------
    // 2. í…ìŠ¤íŠ¸ ì •ê·œí™” (Normalization)
    // ---------------------------------------------------------
    function normalizeText(text) {
        if (!text) return "";
        
        // 0. ë…¸ì´ì¦ˆ ì œê±°
        text = text.replace(/(PDF|XML|HTML)\s*ë‹¤ìš´ë¡œë“œ/gi, "");
        text = text.replace(/ë³€ê²½\s*ì´ë ¥/g, "");
        text = text.replace(/https?:\/\/\S+/g, "");
        text = text.replace(/\d{2,4}[. ]+\d{1,2}[. ]+\d{1,2}[.]?/g, ""); // Date
        text = text.replace(/(ì˜¤ì „|ì˜¤í›„)\s*\d{1,2}\s*[:]\s*\d{2}(?:\s*[:]\s*\d{2})?/g, ""); // Time
        text = text.replace(/\b\d+\s*\/\s*\d+\b/g, ""); // Page num
        text = text.replace(/cacheSeq=[a-zA-Z0-9]+/g, "");

        // -------------------------------------------------------------
        // [ì¶”ê°€] 1. íŠ¹ìˆ˜ë¬¸ì/ë¬¸ì¥ë¶€í˜¸ ì œê±°
        // ë§ˆì¹¨í‘œ(.), ì‰¼í‘œ(,) ë“±ìœ¼ë¡œ ì¸í•œ ì°¨ì´ë¥¼ ë¬´ì‹œí•˜ê¸° ìœ„í•´ ê³µë°±ìœ¼ë¡œ ì¹˜í™˜
        text = text.replace(/[.\-,\[\]\(\)\{\}\'"Â·ã†â€¢â–¶â– ]/g, " ");

        // [ì‚­ì œë¨] í•œê¸€ ê¸€ì ì‚¬ì´ ê³µë°± ì œê±° ë¡œì§
        // -------------------------------------------------------------

        // 3. ì¢…ê²°ì–´ë¯¸ í†µì¼ (ì¡´ëŒ“ë§ -> ë°˜ë§í™”)
        // í•©ë‹ˆë‹¤ -> í•œë‹¤, ë©ë‹ˆë‹¤ -> ëœë‹¤ ë“±ìœ¼ë¡œ í†µì¼í•˜ì—¬ "í•©ë‹ˆë‹¤/í•œë‹¤" ì°¨ì´ ë¬´ì‹œ
        text = text.replace(/í•©ë‹ˆë‹¤/g, "í•œë‹¤");
        text = text.replace(/ë©ë‹ˆë‹¤/g, "ëœë‹¤");
        text = text.replace(/ìˆìŠµë‹ˆë‹¤/g, "ìˆë‹¤");
        text = text.replace(/ì—†ìŠµë‹ˆë‹¤/g, "ì—†ë‹¤");
        text = text.replace(/ê²ƒì…ë‹ˆë‹¤/g, "ê²ƒì´ë‹¤");
        text = text.replace(/ê°€ëŠ¥í•©ë‹ˆë‹¤/g, "ê°€ëŠ¥í•˜ë‹¤");

        // ê¸°ì¡´ ë¡œì§: (í–ˆ/ì˜€...)(ìŠµë‹ˆ/ì˜µë‹ˆ..)?ë‹¤ -> ë‹¤
        text = text.replace(/(í–ˆ|ì˜€|ì•˜|ì—ˆ|ê² )?(ìŠµë‹ˆ|ì˜µë‹ˆ|ë¹„ë‹ˆ)?ë‹¤\b/g, "$1ë‹¤");
        text = text.replace(/ì…ë‹ˆë‹¤\b/g, "ì´ë‹¤");

        // 4. ê³µë°± ì •ë¦¬
        text = text.replace(/\t/g, " ");
        text = text.replace(/\s+/g, " ").trim();

        return text; 
    }

    // ---------------------------------------------------------
    // 3. ë¹„êµ (Diff) ë° ì‹œê°í™” using jsdiff
    // ---------------------------------------------------------
    function computeDiff(text1, text2) {
        // ì •ê·œí™” (ë¹„êµìš©)
        const norm1 = normalizeText(text1);
        const norm2 = normalizeText(text2);

        // jsdiffì˜ diffWords ì‚¬ìš© (ë‹¨ì–´ ë‹¨ìœ„ ë¹„êµ)
        // Diff.diffWords(oldStr, newStr) -> [{value: "...", added: boolean, removed: boolean}, ...]
        const diffs = Diff.diffWords(norm1, norm2);

        let htmlLeft = "";
        let htmlRight = "";

        diffs.forEach((part) => {
            // valueì˜ íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ ë° ì¤„ë°”ê¿ˆ ì²˜ë¦¬
            const escapedValue = part.value
                .replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
                .replace(/\n/g, "<br>");

            if (part.added) {
                // ì¶”ê°€ë¨ -> ì˜¤ë¥¸ìª½ íŒ¨ë„ì— ì´ˆë¡ìƒ‰
                htmlRight += `<ins>${escapedValue}</ins>`;
            } else if (part.removed) {
                // ì‚­ì œë¨ -> ì™¼ìª½ íŒ¨ë„ì— ë¹¨ê°„ìƒ‰
                htmlLeft += `<del>${escapedValue}</del>`;
            } else {
                // ë™ì¼í•¨ -> ì–‘ìª½ì— í‰ë¬¸
                htmlLeft += `<span>${escapedValue}</span>`;
                htmlRight += `<span>${escapedValue}</span>`;
            }
        });

        return { left: htmlLeft, right: htmlRight, diffs: diffs };
    }

    // ---------------------------------------------------------
    // 4. í•µì‹¬ ë³€ê²½ ìš”ì•½ (Summary)
    // ---------------------------------------------------------
    function summarizeChanges(diffs) {
        const summaryDiv = document.getElementById('summaryOutput');
        let html = "";
        let hasChanges = false;

        // ë‹¨ìˆœ ìêµ¬ ìˆ˜ì • ë“±ì„ ê±°ë¥´ê¸° ìœ„í•œ ê¸¸ì´ ì„ê³„ê°’ (ê¸€ììˆ˜)
        const LENGTH_THRESHOLD = 15;

        diffs.forEach(part => {
            // ê³µë°± ì •ë¦¬ í›„ ê¸¸ì´ ì²´í¬
            const text = part.value.trim().replace(/\s+/g, ' ');
            if (text.length < LENGTH_THRESHOLD) return;

            // [ì¶”ê°€] íŠ¹ì • ë…¸ì´ì¦ˆ ë¬¸êµ¬ í•„í„°ë§ (ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜... ë“±)
            // PDF íŒŒì‹± ì‹œ ê¸€ì ì‚¬ì´ì— ê³µë°±ì´ ë“¤ì–´ê°€ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„í•´, ê³µë°±ì„ ë‹¤ ë¹¼ê³  ê²€ì‚¬
            const cleanText = text.replace(/\s/g, "");
            if (cleanText.includes("ì‹í’ˆì˜ì•½í’ˆì•ˆì „ì²˜ì˜ì•½í’ˆí†µí•©ì •ë³´ì‹œìŠ¤í…œ")) return;

            // HTML ì´ìŠ¤ì¼€ì´í”„
            const safeText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

            if (part.added) {
                html += `<div style="margin-bottom: 12px; padding: 12px; background-color: #e6ffed; border-left: 5px solid #22863a; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    <div style="font-weight:bold; color:#22863a; margin-bottom:4px;">[ìƒˆë¡œ ì¶”ê°€ë¨]</div>
                    <div style="color:#333;">${safeText}</div>
                </div>`;
                hasChanges = true;
            } else if (part.removed) {
                html += `<div style="margin-bottom: 12px; padding: 12px; background-color: #ffeef0; border-left: 5px solid #b31d28; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    <div style="font-weight:bold; color:#b31d28; margin-bottom:4px;">[ì‚­ì œë¨]</div>
                    <div style="color:#333; text-decoration: line-through; opacity: 0.8;">${safeText}</div>
                </div>`;
                hasChanges = true;
            }
        });

        if (!hasChanges) {
            summaryDiv.innerHTML = "<p style='color:#999; text-align: center; padding: 20px;'>âš ï¸ êµµì§í•œ ë¬¸ì¥ ë‹¨ìœ„ì˜ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤. (ë‹¨ìˆœ ìêµ¬ ìˆ˜ì • ìœ„ì£¼)</p>";
        } else {
            summaryDiv.innerHTML = html;
        }
    }


    // ---------------------------------------------------------
    // Event Listeners
    // ---------------------------------------------------------
    // ---------------------------------------------------------
    // Drag & Drop UI Logic
    // ---------------------------------------------------------
    function setupDropZone(zoneId, inputId, nameId) {
        const zone = document.getElementById(zoneId);
        const input = document.getElementById(inputId);
        const nameDisplay = document.getElementById(nameId);

        // í´ë¦­ ì‹œ íŒŒì¼ ì„ íƒì°½ ì—´ê¸°
        zone.addEventListener('click', () => input.click());

        // íŒŒì¼ ì„ íƒ ì‹œ ì²˜ë¦¬
        input.addEventListener('change', () => handleFiles(input.files));

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        zone.addEventListener('dragover', (e) => {
            e.preventDefault();
            zone.classList.add('dragover');
        });
        zone.addEventListener('dragleave', () => {
            zone.classList.remove('dragover');
        });
        zone.addEventListener('drop', (e) => {
            e.preventDefault();
            zone.classList.remove('dragover');
            if (e.dataTransfer.files.length) {
                input.files = e.dataTransfer.files;
                handleFiles(input.files);
            }
        });

        function handleFiles(files) {
            if (files.length > 0) {
                nameDisplay.innerText = "âœ… " + files[0].name;
                zone.classList.add('active');
            }
        }
    }

    setupDropZone('drop-zone-1', 'file1', 'file-name-1');
    setupDropZone('drop-zone-2', 'file2', 'file-name-2');

    document.getElementById('compareBtn').addEventListener('click', async () => {
        const file1 = document.getElementById('file1').files[0];
        const file2 = document.getElementById('file2').files[0];
        
        if (!file1 || !file2) {
            alert("ë‘ ê°œì˜ PDF íŒŒì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        const loader = document.getElementById('loading');
        loader.style.display = 'block';
        document.getElementById('output1').innerHTML = "";
        document.getElementById('output2').innerHTML = "";

        try {
            // 1. í…ìŠ¤íŠ¸ ì¶”ì¶œ
            const text1 = await extractTextFromPdf(file1);
            const text2 = await extractTextFromPdf(file2);

            if (!text1.trim() || !text2.trim()) {
                alert("í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ê±°ë‚˜, ë¹„êµí•  í•µì‹¬ ì„¹ì…˜(íš¨ëŠ¥/ìš©ë²• ë“±)ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                loader.style.display = 'none';
                return;
            }

            // 2. ë¹„êµ
            const result = computeDiff(text1, text2);

            // 3. ì¶œë ¥
            document.getElementById('output1').innerHTML = result.left;
            document.getElementById('output2').innerHTML = result.right;

            // 4. ìš”ì•½ ì¶œë ¥
            summarizeChanges(result.diffs);

        } catch (e) {
            console.error(e);
            alert("ë¹„êµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.message);
        } finally {
            loader.style.display = 'none';
        }
    });

</script>
</body>
</html>
